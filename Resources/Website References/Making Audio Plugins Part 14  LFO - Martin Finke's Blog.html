<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <meta name=HandheldFriendly content=True> <meta name=MobileOptimized content=320> <meta name=viewport content="width=device-width"> <meta http-equiv=cleartype content=on> <meta property="fb:admins" content=100001493355877> <meta property="og:image" content="http://www.martin-finke.de/blog/img/making_audio_plugins_thumbnail.png"> <meta property="og:image:type" content="image/png"> <meta property="og:image:width" content=100> <meta property="og:image:height" content=100> <title>Making Audio Plugins Part 14: LFO - Martin Finke's Blog </title> <link rel=alternate href="/blog/feed.xml" type="application/rss+xml" title="Music &amp; Programming"> <link href="http://fonts.googleapis.com/css?family=Domine:700|Inconsolata:400,700" rel=stylesheet type="text/css"> <link rel=stylesheet href='/blog/css/4407aa6.css'> <!--[if lt IE 9]><script src="/blog/js/vendor/respond.min.js"></script> <meta http-equiv=Page-Enter content="blendTrans(Duration=0.5)"><![endif]--> </head> <body class=article-detail> <header class=header> <div class=content-wrap> <h1>Making Audio Plugins Part 14: LFO</h1> <div class=taglinks><a href="/blog/tags/programming.html" class=taglink>Programming</a>, <a href="/blog/tags/dsp.html" class=taglink>DSP</a>, <a href="/blog/tags/making_audio_plugins.html" class=taglink>Making Audio Plugins</a> </div> </div> </header> <div id=content> <div class=content-wrap> <article class=article> <section class=content><p>The Low Frequency Oscillator (<span class=caps>LFO</span>) is an important part of any classic synthesizer. We&#39;re going to add one to our plugin. <span class=more></span> As the name implies, an <span class=caps>LFO</span> ist just a regular Oscillator! We already have an <code>Oscillator</code> class, so it‘s very easy to add another instance with a low frequency. Let’s start in <em>Synthesis.h</em>: Add the following members to the <code>private</code> section:</p> <pre><code class="lang-cpp">Oscillator mLFO;
<span class="keyword">double</span> lfoFilterModAmount;</code></pre> <p>As you can see, <code>mLFO</code> is just another <code>Oscillator</code> instance. <code>lfoFilterModAmount</code> indicates how much the <span class=caps>LFO</span> will modulate the filter&#39;s cutoff frequency. Of course we have to intialize lfoFilterModAmount. In <em>Synthesis.cpp</em>, add the following entry to the constructor&#39;s initializer&nbsp;list:</p> <pre><code class="lang-cpp">lfoFilterModAmount(<span class="number">0.1</span>)</code></pre> <p>Why <code>0.1</code>? In this post we‘re just going to prove the point that it’s very easy to add an <span class=caps>LFO</span>. We want to hear that it‘s working, so we’re hardcoding a modulation amount here. We will add <span class=caps>GUI</span> controls later as part of a nice redesign. At the very end of the constructor, add the&nbsp;following:</p> <pre><code class="lang-cpp">mLFO.setMode(OSCILLATOR_MODE_TRIANGLE);
mLFO.setFrequency(<span class="number">6.0</span>);
mLFO.setMuted(<span class="keyword">false</span>);</code></pre> <p>This just selects the triangle waveform, sets the oscillator to a frequency of 6 Hz and unmutes it. If we were to add <span class=caps>GUI</span> constrols, the first two would probably be set inside <code>OnParamChange</code> according to user input. Muting and unmuting the oscillator would depend on whether <code>lfoFilterModAmount</code> is equal to&nbsp;zero.</p> <p>Since it&#39;s an <code>Oscillator</code>, we have to inform the <span class=caps>LFO</span> about sample rate changes. Add this line to <code>Synthesis::Reset</code>:</p> <pre><code class="lang-cpp">mLFO.setSampleRate(GetSampleRate());</code></pre> <p>Now let‘s get the <span class=caps>LFO</span> values. We’re doing this in <code>ProcessDoubleReplacing</code>. Change the <code>for</code> loop to the&nbsp;following:</p> <pre><code class="lang-cpp"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nFrames; ++i) {
    mMIDIReceiver.advance();
    <span class="keyword">int</span> velocity = mMIDIReceiver.getLastVelocity();
    <span class="keyword">double</span> lfoFilterModulation = mLFO.nextSample() * lfoFilterModAmount;
    mOscillator.setFrequency(mMIDIReceiver.getLastFrequency());
    mFilter.setCutoffMod((mFilterEnvelopeGenerator.nextSample() * filterEnvelopeAmount) + lfoFilterModulation);
    leftOutput[i] = rightOutput[i] = mFilter.process(mOscillator.nextSample() * mEnvelopeGenerator.nextSample() * velocity / <span class="number">127.0</span>);
}</code></pre> <p>First, we&#39;re calculating <code>lfoFilterModulation</code>: It&#39;s a value between <code>-1</code> and <code>+1</code>. When we call <code>setCutoffMod</code>, we add the filter envelope <em>and</em> the <code>lfoFilterModulation</code> and pass it to <code>setCutoffMod</code>. This means that our filter`s cutoff will be modulated by both the filter envelope and the&nbsp;<span class=caps>LFO</span>.</p> <p>And that&#39;s it! Run the plugin and play around with the filter (you probably want to set the waveform to something different than sine). You should hear the typical pulsating wobbly&nbsp;sound.</p> <p>If you are using a real <span class=caps>MIDI</span> keyboard to test the plugin, you can still play just one note at the time. You can download the source files for this part <a href="/blog/articles/audio-plugins-014-lfo/source.zip">here</a>. Next, we&#39;re going to <a href="/blog/articles/audio-plugins-015-redesign/">redesign our plugin</a> to make it more&nbsp;beautiful:</p> <p><a href="/blog/articles/audio-plugins-014-lfo/redesign.png"><img src="/blog/articles/audio-plugins-014-lfo/redesign.png" alt=""></a></p> </section> </article> <div id=donation_prompt>If you found this useful, please feel free to <form action="https://www.paypal.com/cgi-bin/webscr" method=post target=_top class=donation-form> <input type=hidden name=cmd value=_s-xclick> <input type=hidden name=hosted_button_id value=JQDU8W5PJBWL6> <input type=hidden name=ref value="/blog/articles/audio-plugins-014-lfo/"> <input type=image src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border=0 name=submit alt="PayPal - The safer, easier way to pay online!"><img alt="" border=0 src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width=1 height=1> </form>! </div> <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.martin-finke.de%2Fblog%2F&amp;width=450&amp;height=21&amp;colorscheme=light&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;send=false" scrolling=no frameborder=0 style="border: none; overflow: hidden; width: 200px; height: 21px;" allowtransparency=true></iframe> <div class=comments> <div id=disqus_thread></div> <script type="text/javascript">var disqus_shortname="martinfinke";(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class=dsq-brlink>comments powered by <span class=logo-disqus>| Disqus</span></a> </div> </div> </div> <footer> <div class=content-wrap> <div class=nav><a href="/blog/">« Index</a></div> <section class=copy> <p>&copy; 2014 Martin Finke – <a href="/blog/impressum.html" class=impressum-link>Impressum</a></p> </section> </div> </footer> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/blog/js/vendor/jquery-1.10.2.min.js"><\/script>');</script> <script type="text/javascript">$(document).ready(function(){$('a:link[href^=http]:not([href*="martin-finke.de"])').attr("target","_blank")});</script> <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-43375106-1"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();</script> </body> </html>